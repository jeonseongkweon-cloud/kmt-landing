<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ê°¤ëŸ¬ë¦¬ ì¡°íšŒ | ê³„ëª…íƒœê¶Œë„</title>
  <meta name="description" content="ì´ë¦„ ê²€ìƒ‰ìœ¼ë¡œ ì‚¬ì§„ì„ ë¹ ë¥´ê²Œ ì°¾ê³ , ëª¨ë°”ì¼ì—ì„œ ìŠ¤ì™€ì´í”„ë¡œ í˜ì´ì§€ë¥¼ ë„˜ê²¨ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤." />
  <meta name="theme-color" content="#0b0f19" />

  <style>
    :root{
      --bg:#0b0f19;
      --panel:#111a2e;
      --panel2:#0f1629;
      --line:rgba(255,255,255,.12);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.70);
      --gold:#d7b76a;
      --blue:#4da3ff;
      --shadow: 0 18px 50px rgba(0,0,0,.45);
      --r:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", "Malgun Gothic", Arial, sans-serif;
      background:
        radial-gradient(1200px 700px at 15% 10%, rgba(77,163,255,.15), transparent 55%),
        radial-gradient(900px 600px at 85% 20%, rgba(215,183,106,.12), transparent 55%),
        var(--bg);
      color:var(--text);
    }
    a{color:inherit; text-decoration:none}
    .wrap{max-width:1100px; margin:0 auto; padding:18px 14px 28px;}

    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px; padding:10px 12px;
      border:1px solid var(--line); background:rgba(17,26,46,.65);
      backdrop-filter: blur(10px);
      border-radius: var(--r);
      box-shadow: var(--shadow);
    }
    .brand{display:flex; align-items:center; gap:10px; min-width:0;}
    .badge{
      width:38px; height:38px; border-radius:12px;
      background: linear-gradient(135deg, rgba(215,183,106,.95), rgba(77,163,255,.9));
      display:grid; place-items:center; color:#07101f; font-weight:900;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      flex:0 0 auto;
    }
    .brand h1{font-size:15px; margin:0; line-height:1.15}
    .brand p{margin:0; font-size:12px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}

    .btn{
      border:1px solid var(--line);
      background: rgba(15,22,41,.7);
      color:var(--text);
      padding:10px 12px;
      border-radius: 14px;
      font-weight:800;
      font-size:13px;
      display:inline-flex;
      align-items:center;
      gap:8px;
      cursor:pointer;
      transition:.15s transform ease, .15s opacity ease, .15s border-color ease;
      user-select:none;
    }
    .btn:hover{transform: translateY(-1px); border-color: rgba(77,163,255,.45)}
    .btn:active{transform: translateY(0px); opacity:.9}
    .btn .miniDot{
      width:8px; height:8px; border-radius:999px;
      background: var(--blue);
      box-shadow: 0 0 0 3px rgba(77,163,255,.15);
    }

    .card{
      margin-top:14px;
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(17,26,46,.75), rgba(15,22,41,.55));
      border-radius: var(--r);
      padding:14px;
      box-shadow: var(--shadow);
    }
    .card h2{margin:0 0 8px; font-size:16px}
    .muted{color:var(--muted); font-size:12px; margin:0}
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:10px;}

    .searchBox{
      flex: 1 1 280px;
      display:flex; align-items:center; gap:10px;
      border:1px solid var(--line);
      background: rgba(11,15,25,.55);
      border-radius: 16px;
      padding:10px 12px;
    }
    .searchBox input{
      width:100%;
      border:0; outline:0;
      background:transparent;
      color:var(--text);
      font-size:15px;
    }
    .xBtn{
      border:0;
      background: rgba(255,255,255,.08);
      color:var(--text);
      width:34px; height:34px;
      border-radius: 12px;
      font-weight:900;
      cursor:pointer;
      display:grid; place-items:center;
    }

    .status{
      display:flex; justify-content:space-between; gap:10px; align-items:center;
      margin-top:10px;
      padding-top:10px;
      border-top:1px solid var(--line);
      flex-wrap:wrap;
    }
    .pill{
      display:inline-flex; gap:8px; align-items:center;
      border:1px solid var(--line);
      background: rgba(11,15,25,.4);
      border-radius: 999px;
      padding:8px 10px;
      font-size:12px;
      color:var(--muted);
    }
    .pill b{color:var(--text)}
    .help{font-size:12px; color:var(--muted)}

    /* âœ… ìŠ¤ì™€ì´í”„ í˜ì´ì§€ */
    .pager{
      margin-top:12px;
      border:1px solid var(--line);
      background: rgba(11,15,25,.35);
      border-radius: var(--r);
      overflow:hidden;
    }
    .slides{
      display:flex;
      overflow-x:auto;
      scroll-snap-type:x mandatory;
      -webkit-overflow-scrolling: touch;
      scrollbar-width:none;
    }
    .slides::-webkit-scrollbar{display:none;}
    .page{
      scroll-snap-align:start;
      flex: 0 0 100%;
      padding:12px;
    }
    .grid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap:10px;
    }
    @media (min-width: 720px){
      .page{padding:16px;}
      .grid{grid-template-columns: repeat(4, minmax(0, 1fr)); gap:12px;}
    }
    .thumb{
      position:relative;
      border-radius: 16px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      cursor:pointer;
      aspect-ratio: 1 / 1;
      display:block;
    }
    .thumb img{
      width:100%; height:100%;
      object-fit:cover;
      display:block;
      transform: scale(1.01);
      transition: transform .25s ease;
    }
    .thumb:hover img{transform: scale(1.06);}
    .cap{
      position:absolute; left:8px; right:8px; bottom:8px;
      background: rgba(0,0,0,.45);
      backdrop-filter: blur(6px);
      border:1px solid rgba(255,255,255,.12);
      border-radius: 12px;
      padding:6px 8px;
      font-size:12px;
      color: rgba(255,255,255,.92);
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }

    /* âœ… ë„íŠ¸ */
    .dots{
      display:flex; justify-content:center; gap:8px;
      padding:10px 10px 12px;
      border-top:1px solid var(--line);
    }
    .dot{
      width:8px; height:8px; border-radius:999px;
      background: rgba(255,255,255,.22);
      border:1px solid rgba(255,255,255,.18);
      transition: transform .18s ease, background .18s ease, opacity .18s ease;
      cursor:pointer;
    }
    .dot.active{
      background: rgba(77,163,255,.92);
      border-color: rgba(77,163,255,.55);
      transform: scale(1.25);
    }

    /* âœ… ëª¨ë‹¬(í™•ëŒ€ ë³´ê¸°) */
    .modal{
      position:fixed; inset:0;
      background: rgba(0,0,0,.75);
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
      z-index:99;
    }
    .modal.on{display:flex;}
    .modalCard{
      width:min(980px, 100%);
      border-radius: 20px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(15,22,41,.92);
      box-shadow: 0 30px 80px rgba(0,0,0,.6);
    }
    .modalTop{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
      padding:10px 12px;
      border-bottom:1px solid rgba(255,255,255,.12);
    }
    .modalTop .t{font-weight:900; font-size:13px;}
    .closeBtn{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color:var(--text);
      padding:8px 10px;
      border-radius: 14px;
      font-weight:900;
      cursor:pointer;
    }
    .modalImg{
      width:100%;
      max-height: 76vh;
      object-fit:contain;
      display:block;
      background:#000;
    }
    .modalBottom{
      padding:10px 12px 14px;
      color: var(--muted);
      font-size:12px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    footer{
      margin-top:14px;
      color: rgba(255,255,255,.55);
      font-size:12px;
      text-align:center;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="badge">KM</div>
        <div style="min-width:0">
          <h1>ê³„ëª…íƒœê¶Œë„ Â· ê°¤ëŸ¬ë¦¬ ì¡°íšŒ</h1>
          <p>ì´ë¦„ ê²€ìƒ‰ â†’ ì¸ë„¤ì¼ í™•ì¸ â†’ ì˜†ìœ¼ë¡œ ë°€ì–´ í˜ì´ì§€ ì´ë™</p>
        </div>
      </div>

      <div style="display:flex; gap:8px; align-items:center;">
        <a class="btn" href="../"><span class="miniDot"></span>í™ˆ</a>
      </div>
    </div>

    <section class="card">
      <h2>ì´ë¦„ìœ¼ë¡œ ì‚¬ì§„ ì°¾ê¸°</h2>
      <p class="muted">ì˜ˆ) â€œí™ê¸¸ë™â€ ì²˜ëŸ¼ ì…ë ¥í•˜ë©´ í•´ë‹¹ ì´ë¦„ì˜ ì‚¬ì§„ë§Œ í‘œì‹œë©ë‹ˆë‹¤. (ë¶€ë¶„ ì…ë ¥ë„ ê°€ëŠ¥)</p>

      <div class="row">
        <div class="searchBox" role="search">
          <span style="opacity:.85">ğŸ”</span>
          <input id="q" type="text" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" autocomplete="off" />
          <button class="xBtn" id="clearBtn" aria-label="ì…ë ¥ ì§€ìš°ê¸°">âœ•</button>
        </div>
        <button class="btn" id="showAllBtn" title="ì „ì²´ ë³´ê¸°"><span class="miniDot"></span>ì „ì²´ ë³´ê¸°</button>
      </div>

      <div class="status">
        <div class="pill">ê²€ìƒ‰ ê²°ê³¼: <b id="count">0</b>ì¥</div>
        <div class="help">í˜ì´ì§€ëŠ” <b>ì˜†ìœ¼ë¡œ ë°€ì–´ì„œ</b> ë„˜ê¸¸ ìˆ˜ ìˆì–´ìš”.</div>
      </div>

      <div class="pager" id="pager" style="display:none">
        <div class="slides" id="slides" aria-label="ì‚¬ì§„ í˜ì´ì§€"></div>
        <div class="dots" id="dots" aria-label="í˜ì´ì§€ í‘œì‹œ"></div>
      </div>

      <div id="empty" class="card" style="margin-top:12px; display:none; background:rgba(11,15,25,.35)">
        <h2 style="margin:0 0 6px; font-size:15px;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</h2>
        <p class="muted">ì´ë¦„ ì² ìë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”. (ì˜ˆ: ë„ì–´ì“°ê¸° ì—†ì´ â€œí™ê¸¸ë™â€)</p>
      </div>
    </section>

    <footer>êµ¬ì¡° &gt;&gt; êµì°¨ì›ë¦¬, êµì°¨ì›ë¦¬ ê¸°ë°˜ ë¬´ë„</footer>
  </div>

  <!-- âœ… ëª¨ë‹¬ -->
  <div class="modal" id="modal" role="dialog" aria-modal="true" aria-label="ì‚¬ì§„ í™•ëŒ€ ë³´ê¸°">
    <div class="modalCard">
      <div class="modalTop">
        <div class="t" id="modalTitle">ì‚¬ì§„</div>
        <button class="closeBtn" id="closeModal">ë‹«ê¸°</button>
      </div>
      <img id="modalImg" class="modalImg" alt="í™•ëŒ€ ì‚¬ì§„" />
      <div class="modalBottom">
        <div id="modalInfo"> </div>
        <a id="openOriginal" class="btn" href="#" target="_blank" rel="noopener">ì›ë³¸ ì—´ê¸°</a>
      </div>
    </div>
  </div>

  <script src="./data.js"></script>
  <script>
    const ALL = Array.isArray(window.GALLERY_PHOTOS) ? window.GALLERY_PHOTOS : [];

    const $q = document.getElementById('q');
    const $count = document.getElementById('count');
    const $pager = document.getElementById('pager');
    const $slides = document.getElementById('slides');
    const $dots = document.getElementById('dots');
    const $empty = document.getElementById('empty');

    const $clearBtn = document.getElementById('clearBtn');
    const $showAllBtn = document.getElementById('showAllBtn');

    const $modal = document.getElementById('modal');
    const $modalImg = document.getElementById('modalImg');
    const $modalTitle = document.getElementById('modalTitle');
    const $modalInfo = document.getElementById('modalInfo');
    const $openOriginal = document.getElementById('openOriginal');
    const $closeModal = document.getElementById('closeModal');

    const PER_PAGE_MOBILE = 9;   // 3x3
    const PER_PAGE_DESKTOP = 12; // 4x3

    function perPage(){
      return (window.matchMedia && window.matchMedia('(min-width:720px)').matches)
        ? PER_PAGE_DESKTOP
        : PER_PAGE_MOBILE;
    }

    function norm(s){ return String(s||"").trim().toLowerCase(); }

    function match(item, q){
      if(!q) return true;
      const name = norm(item.name);
      return name.includes(q);
    }

    function chunk(arr, size){
      const out = [];
      for(let i=0;i<arr.length;i+=size) out.push(arr.slice(i,i+size));
      return out;
    }

    function openModal(item, idx){
      $modalTitle.textContent = `${item.name || "ì‚¬ì§„"} Â· #${idx+1}`;
      $modalInfo.textContent = item.url ? item.url : "";
      $modalImg.src = item.url || item.thumb || "";
      $openOriginal.href = item.url || item.thumb || "#";
      $modal.classList.add('on');
      document.body.style.overflow = 'hidden';
    }

    function closeModal(){
      $modal.classList.remove('on');
      document.body.style.overflow = '';
      $modalImg.src = "";
    }

    function render(list){
      const size = perPage();
      const pages = chunk(list, size);

      $count.textContent = String(list.length);

      $slides.innerHTML = "";
      $dots.innerHTML = "";

      if(list.length === 0){
        $pager.style.display = "none";
        $empty.style.display = "block";
        return;
      }

      $empty.style.display = "none";
      $pager.style.display = "block";

      pages.forEach((pageItems, pi) => {
        const page = document.createElement('div');
        page.className = "page";
        page.dataset.page = String(pi);

        const grid = document.createElement('div');
        grid.className = "grid";

        pageItems.forEach((item, localIdx) => {
          const globalIdx = pi*size + localIdx;
          const a = document.createElement('a');
          a.className = "thumb";
          a.href = "javascript:void(0)";
          a.setAttribute('role','button');
          a.setAttribute('aria-label', `${item.name || "ì‚¬ì§„"} ë³´ê¸°`);

          const img = document.createElement('img');
          img.loading = "lazy";
          img.src = item.thumb || item.url || "";
          img.alt = item.name || "ì‚¬ì§„";

          const cap = document.createElement('div');
          cap.className = "cap";
          cap.textContent = item.name || "ì‚¬ì§„";

          a.appendChild(img);
          a.appendChild(cap);
          a.addEventListener('click', () => openModal(item, globalIdx));

          grid.appendChild(a);
        });

        page.appendChild(grid);
        $slides.appendChild(page);

        const dot = document.createElement('div');
        dot.className = "dot" + (pi===0 ? " active" : "");
        dot.title = `${pi+1} í˜ì´ì§€`;
        dot.addEventListener('click', () => {
          const target = $slides.querySelector(`.page[data-page="${pi}"]`);
          if(target) target.scrollIntoView({behavior:'smooth', inline:'start'});
        });
        $dots.appendChild(dot);
      });

      // âœ… í˜„ì¬ í˜ì´ì§€ ê°ì§€ -> ë„íŠ¸ í™œì„±í™”
      const pagesEls = Array.from($slides.querySelectorAll('.page'));
      const dotEls = Array.from($dots.querySelectorAll('.dot'));

      const io = new IntersectionObserver((entries) => {
        // ê°€ì¥ ë§ì´ ë³´ì´ëŠ” pageë¥¼ activeë¡œ
        let best = null;
        for(const e of entries){
          if(!best || e.intersectionRatio > best.intersectionRatio) best = e;
        }
        if(best && best.isIntersecting){
          const idx = Number(best.target.dataset.page || 0);
          dotEls.forEach((d,i)=> d.classList.toggle('active', i===idx));
        }
      }, { root: $slides, threshold: [0.55, 0.75, 0.9] });

      pagesEls.forEach(p => io.observe(p));
    }

    function applyQuery(){
      const q = norm($q.value);
      const filtered = ALL.filter(it => match(it, q));
      render(filtered);

      // âœ… ê²€ìƒ‰ì–´ë¥¼ ì£¼ì†Œì— ë°˜ì˜(ê³µìœ ìš©)
      const url = new URL(location.href);
      if(q) url.searchParams.set('q', q);
      else url.searchParams.delete('q');
      history.replaceState(null, "", url.toString());
    }

    // âœ… ì´ë²¤íŠ¸
    $q.addEventListener('input', () => applyQuery());
    $clearBtn.addEventListener('click', () => { $q.value=""; $q.focus(); applyQuery(); });
    $showAllBtn.addEventListener('click', () => { $q.value=""; applyQuery(); });

    $closeModal.addEventListener('click', closeModal);
    $modal.addEventListener('click', (e) => { if(e.target === $modal) closeModal(); });
    window.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeModal(); });

    // âœ… ì´ˆê¸°: URLì— ?q=í™ê¸¸ë™ ìˆìœ¼ë©´ ìë™ ê²€ìƒ‰
    (function init(){
      const params = new URLSearchParams(location.search);
      const q = params.get('q');
      if(q){ $q.value = q; }
      render(ALL);
      if($q.value) applyQuery();
    })();

    // âœ… í™”ë©´ í¬ê¸° ë°”ë€Œë©´ í˜ì´ì§€ë‹¹ ê°œìˆ˜ ì¬ê³„ì‚°
    window.addEventListener('resize', () => {
      // í˜„ì¬ ê²€ìƒ‰ ìœ ì§€
      const current = norm($q.value);
      const filtered = ALL.filter(it => match(it, current));
      render(filtered);
    });
  </script>
</body>
</html>
